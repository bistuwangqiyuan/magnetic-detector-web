# 磁检测仪器网页版 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
高端工业级接触式磁检测仪器网页版软件，用于钢管、钢板等铁磁性材料的无损检测，通过磁漏检测技术识别材料内部和表面缺陷。

### 1.2 目标用户
- **主要用户**：质量检测工程师、无损检测技术人员
- **使用场景**：工业生产线、质检实验室、现场检测
- **技能水平**：熟悉磁检测原理，具备基础计算机操作能力

### 1.3 产品目标
- 提供专业、高效的磁检测数据采集和分析工具
- 实现实时监测、历史数据分析、自动化报告生成
- 界面设计符合工业设备标准，操作直观便捷
- 数据存储云端化，支持跨设备访问

## 2. 核心功能

### 2.1 实时监测模块

#### 2.1.1 数据采集
- **采样模式**：连续采样、触发采样
- **采样频率**：10Hz - 10kHz可调
- **数据类型**：磁场强度、位置坐标、时间戳
- **缓冲机制**：实时数据流，最多保存10000个采样点

#### 2.1.2 波形显示
- **显示模式**：
  - **A-SCAN**：时间-幅值显示，单点波形
  - **B-SCAN**：位置-时间灰度图，扫描成像
  - **C-SCAN**：平面视图，缺陷分布图
- **交互功能**：
  - 缩放：鼠标滚轮或双指缩放
  - 平移：拖拽移动
  - 测量：游标测量时间、幅值、距离
  - 冻结：暂停数据刷新
- **网格显示**：可配置网格密度和颜色

#### 2.1.3 缺陷检测
- **门限设置**：上下双门限，可拖拽调节
- **检测算法**：
  - 幅值阈值检测
  - 波形特征识别
  - 峰值检测
- **报警功能**：
  - 视觉报警：界面高亮、闪烁
  - 声音报警：可选开关
  - 记录保存：自动保存报警事件

#### 2.1.4 参数显示
- **实时参数**：
  - 当前幅值
  - 峰值
  - 位置信息
  - 检测速度
  - 缺陷计数
- **设备状态**：
  - 运行状态
  - 连接状态
  - 错误信息

### 2.2 历史数据分析模块

#### 2.2.1 数据管理
- **数据列表**：
  - 测试日期时间
  - 工件信息（编号、材质、规格）
  - 测试类型
  - 操作员
  - 缺陷数量
  - 测试结果（合格/不合格）
- **筛选功能**：
  - 日期范围
  - 工件编号
  - 测试类型
  - 结果状态
- **排序功能**：按日期、缺陷数量等排序

#### 2.2.2 数据回放
- **波形回放**：完整重现历史测试过程
- **速度控制**：0.5x, 1x, 2x, 5x播放速度
- **逐帧查看**：精确定位缺陷位置

#### 2.2.3 数据对比
- **多组对比**：最多4组数据同时对比
- **同步显示**：时间轴同步
- **差异分析**：波形叠加显示

### 2.3 数据分析模块

#### 2.3.1 频谱分析
- **FFT变换**：快速傅里叶变换
- **频域显示**：频率-幅值谱图
- **谐波分析**：识别干扰信号

#### 2.3.2 统计分析
- **基础统计**：
  - 均值、中值
  - 标准差、方差
  - 最大值、最小值
  - 峰峰值
- **缺陷统计**：
  - 缺陷类型分布
  - 缺陷位置分布
  - 缺陷深度分布
  - 时间趋势图

#### 2.3.3 智能识别
- **缺陷分类**：
  - 裂纹类（表面裂纹、内部裂纹）
  - 孔洞类（气孔、砂眼）
  - 夹杂类（夹渣、夹砂）
  - 其他类（折叠、重皮）
- **严重程度评估**：轻微、中等、严重

### 2.4 报告生成模块

#### 2.4.1 报告模板
- **标准模板**：符合ISO/ASTM标准
- **自定义模板**：用户可创建模板
- **模板内容**：
  - 公司信息、Logo
  - 测试基本信息
  - 测试参数表
  - 波形图表
  - 缺陷统计表
  - 结论和建议
  - 签字栏

#### 2.4.2 报告生成
- **格式支持**：PDF（主要）、Excel（数据导出）
- **自动填充**：测试数据自动填入模板
- **图表导出**：高清波形图、统计图表
- **批量生成**：支持批量报告生成

#### 2.4.3 报告管理
- **报告列表**：历史报告查询
- **预览功能**：生成前预览
- **下载功能**：本地保存
- **打印功能**：直接打印

### 2.5 参数设置模块

#### 2.5.1 采集参数
- **采样频率**：10Hz - 10kHz
- **采样点数**：1000 - 10000点
- **触发模式**：自动、手动、外部触发
- **触发电平**：可调节

#### 2.5.2 显示参数
- **显示模式**：A/B/C-SCAN切换
- **时间基准**：0.1ms - 1s/格
- **幅值基准**：自动或手动设置
- **颜色方案**：绿色/黄色波形，多种配色

#### 2.5.3 检测参数
- **上门限**：0-100%可调
- **下门限**：0-100%可调
- **灵敏度**：1-10级可调
- **噪声抑制**：开/关

#### 2.5.4 测试模板
- **预设模板**：
  - 钢管检测模板
  - 钢板检测模板
  - 焊缝检测模板
- **自定义模板**：保存常用参数组合
- **模板导入导出**：JSON格式

### 2.6 校准管理模块

#### 2.6.1 校准向导
- **步骤1**：选择标准试块
- **步骤2**：采集校准数据
- **步骤3**：计算校准曲线
- **步骤4**：验证校准结果
- **步骤5**：保存校准参数

#### 2.6.2 标准试块
- **类型**：
  - 平底孔试块
  - 槽型试块
  - 阶梯试块
- **参数**：孔径、深度、材质

#### 2.6.3 校准曲线
- **DAC曲线**：距离-幅值补偿曲线
- **AVG曲线**：距离-增益曲线
- **曲线显示**：图形化显示
- **曲线编辑**：手动调节

## 3. 界面设计规范

### 3.1 设计原则
- **工业化**：金属质感，专业感强
- **高对比**：清晰易读，减少视觉疲劳
- **信息层级**：主次分明，关键信息突出
- **操作便捷**：常用功能快速访问

### 3.2 配色方案
- **主色调**：橙色（#FF6B1A）- 强调色
- **辅助色**：深灰（#2A2A2A）- 背景色
- **强调色**：黄色（#FFFF00）- 门限线
- **波形色**：绿色（#00FF00）- 正常波形
- **报警色**：红色（#FF0000）- 警告信息
- **文字色**：白色（#FFFFFF）- 主要文字

### 3.3 布局结构

#### 主界面布局
```
┌─────────────────────────────────────────────┐
│  [顶部状态栏] 日期时间 | 设备状态 | 操作员   │
├─────┬─────────────────────────────────┬─────┤
│     │  [数据表格区]                   │     │
│  左 │  ┌─────────────────────────────┐ │  右 │
│  侧 │  │                             │ │  侧 │
│  按 │  │   [波形显示区]              │ │  控 │
│  钮 │  │   Canvas 绘制区域           │ │  制 │
│  区 │  │                             │ │  按 │
│     │  └─────────────────────────────┘ │  钮 │
│     │  [底部控制栏] 分页 | 功能按钮    │     │
└─────┴─────────────────────────────────┴─────┘
```

### 3.4 组件设计

#### 3.4.1 按钮
- **大型功能按钮**：120x60px，圆角5px
- **图标按钮**：40x40px，圆形或方形
- **文字按钮**：自适应宽度，高度36px
- **状态**：正常、悬停、按下、禁用

#### 3.4.2 输入框
- **文本输入**：高度36px，边框1px
- **数字输入**：带增减按钮
- **下拉选择**：自定义样式
- **滑块**：用于连续值调节

#### 3.4.3 表格
- **斑马纹**：提高可读性
- **排序功能**：点击表头排序
- **行选择**：支持单选、多选
- **固定表头**：滚动时表头固定

#### 3.4.4 图表
- **波形图**：Canvas绘制，高性能
- **柱状图**：缺陷统计
- **饼图**：缺陷分类占比
- **折线图**：趋势分析

## 4. 数据模型设计

### 4.1 测试记录表 (test_records)
```sql
id: UUID (主键)
test_date: TIMESTAMP (测试日期时间)
workpiece_id: VARCHAR(50) (工件编号)
workpiece_material: VARCHAR(50) (材质)
workpiece_spec: VARCHAR(100) (规格)
test_type: VARCHAR(50) (测试类型)
operator: VARCHAR(50) (操作员)
sampling_rate: INTEGER (采样频率 Hz)
sensitivity: INTEGER (灵敏度 1-10)
upper_gate: FLOAT (上门限 %)
lower_gate: FLOAT (下门限 %)
defect_count: INTEGER (缺陷数量)
test_result: VARCHAR(20) (合格/不合格)
notes: TEXT (备注)
created_at: TIMESTAMP
```

### 4.2 波形数据表 (waveform_data)
```sql
id: UUID (主键)
test_record_id: UUID (外键 -> test_records)
position: FLOAT (位置 mm)
timestamp: FLOAT (时间 ms)
amplitude: FLOAT (幅值)
data_points: JSONB (完整波形数据数组)
created_at: TIMESTAMP
```

### 4.3 缺陷记录表 (defects)
```sql
id: UUID (主键)
test_record_id: UUID (外键 -> test_records)
defect_type: VARCHAR(50) (缺陷类型)
defect_severity: VARCHAR(20) (严重程度)
position_start: FLOAT (起始位置 mm)
position_end: FLOAT (结束位置 mm)
depth_estimate: FLOAT (估计深度 mm)
amplitude_peak: FLOAT (峰值幅值)
width: FLOAT (宽度 mm)
description: TEXT (描述)
created_at: TIMESTAMP
```

### 4.4 校准设置表 (calibration_settings)
```sql
id: UUID (主键)
calibration_date: TIMESTAMP (校准日期)
standard_block_type: VARCHAR(50) (标准试块类型)
calibration_curve: JSONB (校准曲线数据)
operator: VARCHAR(50) (操作员)
valid_until: TIMESTAMP (有效期)
is_active: BOOLEAN (是否启用)
notes: TEXT (备注)
created_at: TIMESTAMP
```

### 4.5 测试模板表 (test_templates)
```sql
id: UUID (主键)
template_name: VARCHAR(100) (模板名称)
template_type: VARCHAR(50) (模板类型)
parameters: JSONB (参数配置)
description: TEXT (描述)
is_default: BOOLEAN (是否默认)
created_by: VARCHAR(50) (创建者)
created_at: TIMESTAMP
updated_at: TIMESTAMP
```

### 4.6 报告记录表 (reports)
```sql
id: UUID (主键)
test_record_id: UUID (外键 -> test_records)
report_title: VARCHAR(200) (报告标题)
report_type: VARCHAR(50) (报告类型)
generated_date: TIMESTAMP (生成日期)
generated_by: VARCHAR(50) (生成者)
file_url: TEXT (文件URL)
file_size: INTEGER (文件大小 bytes)
created_at: TIMESTAMP
```

## 5. 技术架构

### 5.1 技术栈
- **前端框架**：原生 HTML5 + CSS3 + ES6+ JavaScript
- **图形渲染**：Canvas API（波形绘制）
- **数据可视化**：Chart.js（统计图表）
- **PDF生成**：jsPDF + html2canvas
- **后端服务**：Supabase（BaaS）
- **数据库**：PostgreSQL（Supabase托管）
- **存储服务**：Supabase Storage
- **部署平台**：Netlify / Vercel

### 5.2 架构图
```
┌─────────────────────────────────────────┐
│         用户界面层 (UI Layer)           │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │主界面   │  │数据分析 │  │报告管理 │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│       业务逻辑层 (Logic Layer)          │
│  ┌──────────┐  ┌──────────┐  ┌────────┐│
│  │波形生成  │  │缺陷检测  │  │数据分析││
│  └──────────┘  └──────────┘  └────────┘│
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│       数据访问层 (Data Layer)           │
│  ┌──────────┐  ┌──────────┐            │
│  │Supabase  │  │Local     │            │
│  │Client    │  │Storage   │            │
│  └──────────┘  └──────────┘            │
└─────────────┬───────────────────────────┘
              │
┌─────────────▼───────────────────────────┐
│         Supabase 后端服务               │
│  ┌──────────┐  ┌──────────┐  ┌────────┐│
│  │PostgreSQL│  │Storage   │  │Realtime││
│  └──────────┘  └──────────┘  └────────┘│
└─────────────────────────────────────────┘
```

### 5.3 文件结构
```
maguitest/
├── index.html                    # 主界面
├── pages/
│   ├── history.html             # 历史数据
│   ├── analysis.html            # 数据分析
│   ├── reports.html             # 报告管理
│   ├── settings.html            # 参数设置
│   └── calibration.html         # 校准管理
├── css/
│   ├── main.css                 # 主样式
│   ├── industrial.css           # 工业风格
│   └── responsive.css           # 响应式
├── js/
│   ├── config.js                # 配置文件
│   ├── database.js              # 数据库操作
│   ├── waveform.js              # 波形生成
│   ├── realtime.js              # 实时监测
│   ├── analysis.js              # 数据分析
│   ├── report.js                # 报告生成
│   └── utils.js                 # 工具函数
├── assets/
│   ├── images/                  # 图片资源
│   └── icons/                   # 图标
├── lib/
│   ├── supabase.js              # Supabase客户端
│   ├── chart.min.js             # Chart.js
│   └── jspdf.min.js             # jsPDF
├── .env                         # 环境变量
├── README.md                    # 项目说明
├── PRD.md                       # 产品需求文档
└── DATABASE_SCHEMA.md           # 数据库设计
```

## 6. 测试内容设计（基于国际标准）

### 6.1 标准参考
- **ISO 10893-10:2011** - 钢管的无损检测 - 第10部分：铁磁性无缝和焊接钢管的漏磁检测
- **ASTM E1316** - 无损检测术语标准
- **EN 10246-10** - 钢管的无损检测 - 漏磁检测
- **GB/T 12606** - 钢管漏磁探伤方法

### 6.2 标准测试流程

#### 6.2.1 测试前准备
1. 工件清洁处理
2. 设备校准验证
3. 参数设置确认
4. 标准试块对比测试

#### 6.2.2 测试执行
1. 工件信息录入
2. 选择测试模板
3. 启动实时监测
4. 观察波形变化
5. 记录缺陷信息

#### 6.2.3 测试后处理
1. 数据保存
2. 缺陷分析
3. 结果评定
4. 报告生成

### 6.3 缺陷判定标准

#### 6.3.1 缺陷分类
| 缺陷类型 | 特征波形 | 判定依据 |
|---------|---------|---------|
| 表面裂纹 | 尖锐峰值 | 幅值>80%，宽度<2mm |
| 内部裂纹 | 宽峰值 | 幅值60-80%，宽度>2mm |
| 气孔 | 圆形峰 | 幅值40-60%，对称波形 |
| 夹杂 | 不规则峰 | 幅值30-50%，不对称 |

#### 6.3.2 严重程度评估
- **轻微**：幅值20-40%，单一小缺陷
- **中等**：幅值40-70%，多个小缺陷或单个中等缺陷
- **严重**：幅值>70%，贯穿性缺陷或密集缺陷群

#### 6.3.3 合格判定
- 无严重缺陷
- 中等缺陷数量≤2个
- 轻微缺陷数量≤5个
- 符合客户特殊要求

## 7. 性能指标要求

### 7.1 功能性能
- **数据采集频率**：最高10kHz
- **波形刷新率**：≥30 FPS
- **数据存储延迟**：<100ms
- **缺陷检测准确率**：≥95%
- **误报率**：<5%

### 7.2 界面性能
- **首屏加载时间**：<2秒
- **页面切换时间**：<500ms
- **波形绘制延迟**：<16ms（60fps）
- **大数据量加载**：10000点<1秒

### 7.3 兼容性要求
- **浏览器支持**：Chrome 90+, Edge 90+, Firefox 88+
- **屏幕分辨率**：1920x1080及以上
- **操作系统**：Windows 10+, macOS 10.14+, Linux

### 7.4 可用性要求
- **系统可用性**：≥99.9%
- **数据备份**：自动备份，保留30天
- **并发用户**：支持单用户（本版本）

## 8. 安全性要求

### 8.1 数据安全
- 数据传输：HTTPS加密
- 数据存储：Supabase安全存储
- 数据备份：自动云端备份

### 8.2 访问控制
- 单用户模式（本版本）
- 浏览器本地存储偏好设置
- 未来支持多用户权限管理

## 9. 项目里程碑

### 第一阶段：文档与架构（1天）
- 完成PRD、README、数据库设计文档
- 创建项目结构
- 搭建Supabase数据库

### 第二阶段：主界面开发（2天）
- 完成主界面UI
- 实现波形生成和绘制
- 实现实时监测逻辑

### 第三阶段：功能页面开发（2天）
- 完成历史数据页面
- 完成数据分析页面
- 完成报告管理页面
- 完成设置和校准页面

### 第四阶段：核心功能实现（2天）
- 实现Supabase集成
- 实现缺陷检测算法
- 实现数据分析功能
- 实现报告生成功能

### 第五阶段：测试与优化（1天）
- 功能测试
- 性能优化
- 兼容性测试
- 文档完善

### 第六阶段：部署上线（0.5天）
- 部署到生产环境
- 验证功能
- 用户培训文档

## 10. 未来规划

### 10.1 功能扩展
- 多用户权限管理
- 实时协作功能
- 移动端适配
- 离线模式支持
- AI智能识别

### 10.2 性能优化
- WebWorker多线程处理
- WebAssembly加速计算
- 数据压缩传输
- 增量更新机制

### 10.3 集成扩展
- 硬件设备接口
- 第三方系统集成
- 导出更多格式
- 云端协作平台

---

**文档版本**：v1.0  
**编制日期**：2025-10-06  
**最后更新**：2025-10-06
